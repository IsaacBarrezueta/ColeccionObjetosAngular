<!-- src/app/components/estudiantes/estudiantes.component.html -->
<div class="container">
  <h2>Estudiantes</h2>

  <!-- Tabla Listado -->
  <table class="table table-bordered mt-3">
    <thead class="table-light">
      <tr>
        <th>Código</th>
        <th>Estudiante</th>
        <th>Parcial 1</th>
        <th>Parcial 2</th>
        <th>CF</th>
        <th>ER</th>
        <th>ND</th>
        <th>Estado</th>
        <th>Acciones</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let est of estudianteService.estudiantes; let i=index">
        <td>{{ est.codigo }}</td>
        <td>{{ est.nombres }} {{ est.apellidos }}</td>
        <td>{{ est.parcial1 }}</td>
        <td>{{ est.parcial2 }}</td>
        <td>{{ est.calificacionFinal | number:'1.1-2' }}</td>
        <td>
          {{ est.examenRecuperacion !== undefined ? est.examenRecuperacion : 'N/A' }}
        </td>
        <td>
          {{ est.notaDefinitiva !== undefined ? (est.notaDefinitiva | number:'1.1-2') : 'N/A' }}
        </td>
        <td 
          [ngClass]="{
            'text-success': est.estadoAprobatorio === 'Aprobado',
            'text-danger': est.estadoAprobatorio === 'Reprobado'
          }">
          {{ est.estadoAprobatorio }}
        </td>
        <td>
          <button class="btn btn-warning btn-sm" (click)="editarEstudiante(i)">Actualizar</button>
          <button class="btn btn-danger btn-sm ms-2" (click)="eliminarEstudiante(i)">Eliminar</button>
        </td>
      </tr>
    </tbody>
  </table>

  <hr />

  <!-- Formulario para Crear/Editar -->
  <div class="row mt-4">
    <!-- Datos personales -->
    <div class="col-md-4">
      <h5>Datos del Estudiante</h5>
      <div class="mb-2">
        <label>Cédula</label>
        <input type="text" class="form-control"
               [(ngModel)]="estudianteForm.cedula"
               name="cedula" />
      </div>
      <div class="mb-2">
        <label>Nombres</label>
        <input type="text" class="form-control"
               [(ngModel)]="estudianteForm.nombres"
               name="nombres" />
      </div>
      <div class="mb-2">
        <label>Apellidos</label>
        <input type="text" class="form-control"
               [(ngModel)]="estudianteForm.apellidos"
               name="apellidos" />
      </div>
      <div class="mb-2">
        <label>Sexo</label>
        <select class="form-select"
                [(ngModel)]="estudianteForm.sexo"
                name="sexo">
          <option value="M">Masculino</option>
          <option value="F">Femenino</option>
        </select>
      </div>
      <div class="mb-2">
        <label>Fecha Nacimiento</label>
        <input type="date" class="form-control"
               [(ngModel)]="estudianteForm.fechaNacimiento"
               name="fechaNacimiento" />
      </div>
      <div class="mb-2">
        <label>Código</label>
        <input type="text" class="form-control"
               [(ngModel)]="estudianteForm.codigo"
               name="codigo" />
      </div>
    </div>

    <!-- Notas Parciales y Botones -->
    <div class="col-md-3 offset-md-1">
      <h5>Notas Parciales</h5>
      <div class="mb-2">
        <label>Parcial 1</label>
        <input type="number" class="form-control"
               [(ngModel)]="estudianteForm.parcial1"
               name="parcial1" step="0.1" />
      </div>
      <div class="mb-2">
        <label>Parcial 2</label>
        <input type="number" class="form-control"
               [(ngModel)]="estudianteForm.parcial2"
               name="parcial2" step="0.1" />
      </div>
      <button class="btn btn-primary mt-3" (click)="guardarEstudiante()">
        {{ editIndex === null ? 'Agregar' : 'Actualizar' }}
      </button>
      <button class="btn btn-secondary mt-3 ms-2" (click)="cancelarEdicion()">Cancelar</button>
      <button class="btn btn-info mt-3 ms-2" (click)="verEstadisticas()">
        Ver Estadísticas
      </button>
    </div>

    <!-- Examen de Recuperación, solo si requiereRecuperacion -->
    <div class="col-md-3 offset-md-1" *ngIf="requiereRecuperacion">
      <h5>Examen de Recuperación</h5>
      <p class="text-muted">CF entre 5.5 y 7, ingresa nota de recuperación</p>
      <div class="mb-2">
        <label>Nota ER</label>
        <input type="number" class="form-control"
               [(ngModel)]="estudianteForm.examenRecuperacion"
               name="examenRecuperacion" step="0.1" />
      </div>
    </div>
  </div>
</div>
